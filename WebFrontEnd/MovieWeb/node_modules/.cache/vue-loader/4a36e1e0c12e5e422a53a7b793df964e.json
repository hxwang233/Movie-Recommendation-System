{"remainingRequest":"D:\\JavaWebApplication\\WebFrontEnd\\MovieWeb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\JavaWebApplication\\WebFrontEnd\\MovieWeb\\src\\components\\user\\UserInfo.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"D:\\JavaWebApplication\\WebFrontEnd\\MovieWeb\\src\\components\\user\\UserInfo.vue","mtime":1617108315912},{"path":"D:\\JavaWebApplication\\WebFrontEnd\\MovieWeb\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\JavaWebApplication\\WebFrontEnd\\MovieWeb\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\JavaWebApplication\\WebFrontEnd\\MovieWeb\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\JavaWebApplication\\WebFrontEnd\\MovieWeb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\JavaWebApplication\\WebFrontEnd\\MovieWeb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmF2YXRhci11cGxvYWRlcj4uYW50LXVwbG9hZCB7Cglib3JkZXItcmFkaXVzOiA1MCU7Cn0KCi5hbnQtdXBsb2FkLXNlbGVjdC1waWN0dXJlLWNhcmQgaSB7Cglmb250LXNpemU6IDE2OwoJY29sb3I6ICM5OTk7Cn0KCi5hbnQtdXBsb2FkLXNlbGVjdC1waWN0dXJlLWNhcmQgLmFudC11cGxvYWQtdGV4dCB7CgltYXJnaW4tdG9wOiA4cHg7Cgljb2xvcjogIzY2NjsKfQo="},{"version":3,"sources":["UserInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4MA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"UserInfo.vue","sourceRoot":"src/components/user","sourcesContent":["<template>\r\n\t<div style=\"display: flex; justify-content: center; align-items: center;  height: 100vh;\">\r\n\t\t<div style=\"display: flex; justify-content: space-around\">\r\n\t\t\t<div style=\"margin-top: -100px;\">\r\n\t\t\t\t<a-form-model :model=\"user\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" style=\"width: 500px\">\r\n\t\t\t\t\t<a-form-model-item style=\"display: flex; justify-content: center; margin: 0 0 -5px 80px;\">\r\n\t\t\t\t\t\t<a-upload name=\"file\" list-type=\"picture-card\" class=\"avatar-uploader\" :show-upload-list=\"false\" :action=\"this.$store.state.requestPath + 'uploadHeadPic'\"\r\n\t\t\t\t\t\t :before-upload=\"beforeUpload\" @change=\"handleChange\">\r\n\t\t\t\t\t\t\t<a-avatar :size=\"100\" v-if=\"imageUrl\" :src=\"imageUrl\" />\r\n\t\t\t\t\t\t\t<!-- <img v-if=\"imageUrl\" :src=\"picRequestPath + 'headpic/' + imageUrl\" alt=\"avatar\" style=\"border-radius: 50%; width: 128px; height: 128px;\" /> -->\r\n\t\t\t\t\t\t\t<div v-else>\r\n\t\t\t\t\t\t\t\t<a-icon :type=\"loading ? 'loading' : 'plus'\" />\r\n\t\t\t\t\t\t\t\t<div class=\"ant-upload-text\">\r\n\t\t\t\t\t\t\t\t\t修改\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</a-upload>\r\n\t\t\t\t\t</a-form-model-item>\r\n\t\t\t\t\t<a-form-model-item label=\"用户名\">\r\n\t\t\t\t\t\t<a-input v-model=\"user.name\" disabled />\r\n\t\t\t\t\t</a-form-model-item>\r\n\t\t\t\t\t<!-- \r\n\t\t\t\t\t<a-form-model-item label=\"密码\">\r\n\t\t\t\t\t\t<a-input v-model=\"user.password\" />\r\n\t\t\t\t\t</a-form-model-item> -->\r\n\t\t\t\t\t<a-form-model-item label=\"性别\">\r\n\t\t\t\t\t\t<a-radio-group v-model=\"user.gender\">\r\n\t\t\t\t\t\t\t<a-radio value=\"M\">\r\n\t\t\t\t\t\t\t\t男\r\n\t\t\t\t\t\t\t</a-radio>\r\n\t\t\t\t\t\t\t<a-radio value=\"F\">\r\n\t\t\t\t\t\t\t\t女\r\n\t\t\t\t\t\t\t</a-radio>\r\n\t\t\t\t\t\t</a-radio-group>\r\n\t\t\t\t\t</a-form-model-item>\r\n\t\t\t\t\t<a-form-model-item label=\"年龄段\">\r\n\t\t\t\t\t\t<a-select :default-value=\"ageList[user.age]\" @change=\"handleAgeChange\">\r\n\t\t\t\t\t\t\t<a-select-option :value=key v-for=\"(value, key) in ageList\">\r\n\t\t\t\t\t\t\t\t{{value}}\r\n\t\t\t\t\t\t\t</a-select-option>\r\n\t\t\t\t\t\t</a-select>\r\n\t\t\t\t\t</a-form-model-item>\r\n\t\t\t\t\t<a-form-model-item label=\"职业\">\r\n\t\t\t\t\t\t<a-select :default-value=\"occupationList[user.occupation]\" @change=\"handleOccupationChange\">\r\n\t\t\t\t\t\t\t<a-select-option :value=key v-for=\"(value, key) in occupationList\">\r\n\t\t\t\t\t\t\t\t{{value}}\r\n\t\t\t\t\t\t\t</a-select-option>\r\n\t\t\t\t\t\t</a-select>\r\n\t\t\t\t\t</a-form-model-item>\r\n\t\t\t\t\t<a-form-model-item label=\"邮编\">\r\n\t\t\t\t\t\t<a-input v-model=\"user.zipCode\" />\r\n\t\t\t\t\t</a-form-model-item>\r\n\t\t\t\t\t<a-form-model-item style=\"display: flex; justify-content: space-around;\">\r\n\t\t\t\t\t\t<a-button type=\"primary\" @click=\"onSubmit\" :disabled=\"this.flag>0 ? false : true\">\r\n\t\t\t\t\t\t\t提交\r\n\t\t\t\t\t\t</a-button>\r\n\t\t\t\t\t\t<a-button style=\"margin-left: 20px;\" @click=\"onBack\">\r\n\t\t\t\t\t\t\t返回\r\n\t\t\t\t\t\t</a-button>\r\n\t\t\t\t\t</a-form-model-item>\r\n\t\t\t\t</a-form-model>\r\n\t\t\t</div>\r\n\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n<script>\r\n\timport {\r\n\t\tmapMutations,\r\n\t\tmapState\r\n\t} from 'vuex'\r\n\r\n\tfunction getBase64(img, callback) {\r\n\t\tconst reader = new FileReader();\r\n\t\treader.addEventListener('load', () => callback(reader.result));\r\n\t\treader.readAsDataURL(img);\r\n\t}\r\n\texport default {\r\n\t\tcomputed: {\r\n\t\t\t...mapState(['userInfo', 'requestPath', 'picRequestPath'])\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tflag: -1,\r\n\t\t\t\tlabelCol: {\r\n\t\t\t\t\tspan: 4\r\n\t\t\t\t},\r\n\t\t\t\twrapperCol: {\r\n\t\t\t\t\tspan: 14\r\n\t\t\t\t},\r\n\t\t\t\tuser: {\r\n\t\t\t\t\t\"name\": \"undefine\",\r\n\t\t\t\t\t\"password\": \"undefine\",\r\n\t\t\t\t\t\"gender\": \"undefine\",\r\n\t\t\t\t\t\"age\": null,\r\n\t\t\t\t\t\"occupation\": null,\r\n\t\t\t\t\t\"zipCode\": \"undefine\",\r\n\t\t\t\t\t\"headPic\": \"default.jpg\"\r\n\t\t\t\t},\r\n\t\t\t\tageList: null,\r\n\t\t\t\toccupationList: null,\r\n\t\t\t\tloading: false,\r\n\t\t\t\timageUrl: '',\r\n\t\t\t\tlatestImageUrl: null,\r\n\t\t\t};\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tuser: {\r\n\t\t\t\thandler: function(val, oldval) {\r\n\t\t\t\t\tthis.flag = this.flag + 1;\r\n\t\t\t\t},\r\n\t\t\t\tdeep: true //对象内部的属性监听，也叫深度监听\r\n\t\t\t},\r\n\t\t},\r\n\t\tasync created() {\r\n\t\t\tObject.assign(this.user, this.userInfo);\r\n\t\t\tthis.imageUrl = this.picRequestPath + 'headpic/' + this.user.headPic;\r\n\t\t\tthis.latestImageUrl = this.imageUrl;\r\n\t\t\tthis.getAllAge();\r\n\t\t\tthis.getAllOccupation();\r\n\t\t},\r\n\t\t\r\n\t\tmethods: {\r\n\t\t\t...mapMutations(['updateUserInfo']),\r\n\t\t\tasync getAllAge(){\r\n\t\t\t\tif (this.$store.state.userInfo) {\r\n\t\t\t\t\tlet {\r\n\t\t\t\t\t\tdata\r\n\t\t\t\t\t} = await this.$get(this.$store.state.requestPath + 'allAge');\r\n\t\t\t\t\tthis.ageList = data.data;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log(\"userInfo not found\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tasync getAllOccupation(){\r\n\t\t\t\tif (this.$store.state.userInfo) {\r\n\t\t\t\t\tlet {\r\n\t\t\t\t\t\tdata\r\n\t\t\t\t\t} = await this.$get(this.$store.state.requestPath + 'allOccupation');\r\n\t\t\t\t\tthis.occupationList = data.data;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log(\"userInfo not found\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\thandleAgeChange(value){\r\n\t\t\t\tthis.user.age = value;\r\n\t\t\t},\r\n\t\t\thandleOccupationChange(value){\r\n\t\t\t\tthis.user.occupation = value;\r\n\t\t\t},\r\n\t\t\tasync userUpdate() {\r\n\t\t\t\tconsole.log(this.user)\r\n\t\t\t\tlet {\r\n\t\t\t\t\tdata\r\n\t\t\t\t} = await this.axios.post(this.requestPath + 'userUpdate/', this.user);\r\n\t\t\t\tif (data.code == 0) {\r\n\t\t\t\t\tthis.$message.success(' (｡･∀･)ﾉﾞ 修改成功~ ', 1);\r\n\t\t\t\t\tthis.updateUserInfo(this.user);  // 更新全局数据\r\n\t\t\t\t\tthis.onBack();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$message.error(' (￣△￣；) 出错啦~ ', 2);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tasync onSubmit() {\r\n\t\t\t\tif (this.flag > 0 && this.userInfo) {\r\n\t\t\t\t\tthis.userUpdate();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonBack() {\r\n\t\t\t\tthis.user.pic = this.latestImageUrl;\r\n\t\t\t\tthis.imageUrl =  this.latestImageUrl;\r\n\t\t\t\tthis.$router.push({\r\n\t\t\t\t\tpath: '/home'\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\thandleChange(info) {\r\n\t\t\t\tif (info.file.status === 'uploading') {\r\n\t\t\t\t\tthis.loading = true;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (info.file.status === 'done') {\r\n\t\t\t\t\tgetBase64(info.file.originFileObj, imageUrl => {\r\n\t\t\t\t\t\tthis.imageUrl = imageUrl;\r\n\t\t\t\t\t\tthis.loading = false;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.user.headPic = info.file.response.data.src;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tbeforeUpload(file) {\r\n\t\t\t\tconst isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png';\r\n\t\t\t\tif (!isJpgOrPng) {\r\n\t\t\t\t\tthis.$message.error('You can only upload JPG file!');\r\n\t\t\t\t}\r\n\t\t\t\tconst isLt2M = file.size / 1024 / 1024 < 2;\r\n\t\t\t\tif (!isLt2M) {\r\n\t\t\t\t\tthis.$message.error('Image must smaller than 2MB!');\r\n\t\t\t\t}\r\n\t\t\t\treturn isJpgOrPng && isLt2M;\r\n\t\t\t},\r\n\t\t},\r\n\t};\r\n</script>\r\n\r\n<style>\r\n\t.avatar-uploader>.ant-upload {\r\n\t\tborder-radius: 50%;\r\n\t}\r\n\r\n\t.ant-upload-select-picture-card i {\r\n\t\tfont-size: 16;\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t.ant-upload-select-picture-card .ant-upload-text {\r\n\t\tmargin-top: 8px;\r\n\t\tcolor: #666;\r\n\t}\r\n</style>\n"]}]}